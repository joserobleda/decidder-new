(function(b,f){var d=$("#canvas"),a=$("form#question"),c=window.__userid||false;var e=function(h){h.preventDefault();var g=["#responses","#context","#doubts","#question h1"];
$.get(document.location.pathname,function(l){var m=$(l);for(var k in g){var j=g[k];$(j).replaceWith(m.find(j));}});};$.fn.bindCustomEvents=function(){var g=$(this);
g.find(".confirm").click(function(j){var i=$(this),h=i.data("confirm")||"Are you sure?";if(!confirm(h)){j.preventDefault();}});g.find("a.xhr-refresh").click(e);
g.find(".hide-target").click(function(j){var i=$(this),h=i.data("target");$(h).hide();});g.find("[title]").tipsy({gravity:$.fn.tipsy.autoNS});g.find(".async").click(function(){event.preventDefault();
var h=$(this).attr("href"),i=$(this).attr("target");$.get(h,function(k){var j=$(i).html(k);j.bindCustomEvents();j.show();});});g.find("form").each(function(){});
g.find(".popup").click(function(n){var j=$(this).attr("href"),i=$(this).data("popup-name")||false,k=$(this).data("popup-width")||500,h=$(this).data("popup-height")||280,m=(screen.width/2)-(k/2),l=(screen.height/2)-(h/2);
window.open(j,i,"height="+h+",width="+k+",top="+l+",left="+m+",resizable=no");});g.find(".tw-count").each(function(){var j=$(this),h=j.data("fb-url")||location.href,i="http://urls.api.twitter.com/1/urls/count.json?url="+encodeURI(h)+"&amp;callback=?";
function k(l){j.html(l);}$.getJSON(i,function(l){if(l){k(l.count);}});});g.find(".fb-count").each(function(){var l=$(this),k,j=(l.data("fb-count")||"share")+"_count",h=l.data("fb-url")||location.href,i="https://api.facebook.com/method/fql.query?query=select "+j+" from link_stat where url='"+encodeURI(h)+"'&format=json";
function m(n){l.html(n);}$.getJSON(i,function(n){if(n[0]&&n[0][j]!==f){m(n[0][j]);}});});g.find(".reveal").click(function(){var o=$(this),k=o.data("reveal-target")||null,p=o.data("reveal-src")||null;
if(g.hasClass("modal")){g.remove();}function s(){d.css({height:"100%",overflow:"hidden"});}function l(){d.css({height:"inherit",overflow:"auto"});}function n(v){var u=$(v),w=o.data();
w.open=function(){u.find("input[type=text],textarea,select").not(":disabled").filter(":first").focus();};w.close=function(){l();if(typeof v=="object"){u.remove();
}};u.css("margin-left","-"+(u.outerWidth()/2)+"px");u.css("margin-top","-"+(u.outerHeight()/2)+"px");u.reveal(w);}s();if(k){return n(k);}if(p){var r=$("#loading"),m=false,t,j=p,i="get",q=j.indexOf(":"),h=(q>-1&&q<5);
if(h){i=j.substring(0,q);j=j.substring(q+1);}r.reveal({close:function(){l();if(t&&t.abort()){t.abort();}},opened:function(){if(m){r.trigger("reveal:close");
}}});t=$.ajax({url:j,type:i,error:function(w,u,v){alert(v);m=v;},success:function(w,v,x){var y=x.getResponseHeader("content-type");if(y.indexOf("text/html")===0){var u=$(w).hide().appendTo(d);
r.hide();u.bindCustomEvents();n(u);}}});}});};if(a.length){require(["widget/formEditable"],function(){a.editable(function(g){$(g).bind("edit",function(){$("input.taglist").tagsInput({defaultText:"add predefined response",placeholderColor:"#bbb",ready:function(){$(this).attr("data-form-editing",true);
}});a.find("input.taglist").hide();});$(g).bind("show",function(){console.log("$$$#@");a.find(".tagsinput").remove();a.find("ul.predefinded").addClass("prueba");
});$(g).bind("error",function(){alert("Error, try again!");});if($.address.value()==="/edit"){$(g).bind("show",function(){location.href="#";});g.edit();
}});});require(["/socket.io/socket.io.js"],function(){var j=a.data("is-owner"),k=$("#viewers"),l=$("#updates"),h=1,g=document.location.pathname.split("/")[2],i=io.connect(document.location.protocol+"//"+document.location.host+"/question");
i.on("connect",function(){i.emit("join",g);});i.on("change",function(m){if(j==true&&m.type=="question"){return;}if(c===m.user){return;}l.slideDown();});
i.on("viewers",function(m){if(h!=m){h=m;k.html(m);}});});}$(document).bindCustomEvents();})(window);